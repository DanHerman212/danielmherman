<!-- content/templates/content/base.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}danielmherman.com{% endblock %}</title>

    <!-- Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome Icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Playfair Display for headings, Inter for UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- PrismJS for syntax highlighting (VS Code Dark+ theme) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-vsc-dark-plus.min.css" rel="stylesheet" />
    
    <!-- Customer CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation-->
     <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">Dan Herman</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'home' %}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'category' 'tech' %}">Tech</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'category' 'music' %}">Music</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'category' 'enlightenment' %}">Enlightenment</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'resume' %}">Resume</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'projects' %}">Projects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'contact' %}">Contact</a>
                </li>
            </ul>
        </div>
    </div>
</nav>  

<!-- Messags-->
{% if messages %}
    <div class="container mt-3">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Main Content-->
 <main class="py-4">
    {% block content %}{% endblock %}
 </main>

 <!-- Footer -->
<footer class="bg-dark text-white mt-5 py-4">
    <div class="container text-center">
        <p>&copy; 2026 Dan Herman. All rights reserved.</p>
        <p>
            Developed in house with
            <img src="https://static.djangoproject.com/img/logos/django-logo-negative.svg" alt="Django" height="25" style="vertical-align: bottom;">
        </p>
        <div class="social-links">
            <a href="https://www.linkedin.com/in/danherman/" class="text-white me-3"><i class="fab fa-linkedin fa-2x"></i></a>
            <a href="https://github.com/DanHerman212" class="text-white me-3"><i class="fab fa-github fa-2x"></i></a>
            <a href="https://news.ycombinator.com/user?id=lazarus01" class="text-white me-3"><i class="fab fa-hacker-news fa-2x"></i></a>
        </div>
    </div>
</footer>

<!-- Bootstrap JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- PrismJS Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

<!-- Mermaid.js for diagrams -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

<!-- Auto-highlight code blocks and render Mermaid diagrams -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Mermaid with GitHub-like light theme
    mermaid.initialize({
        startOnLoad: false,
        theme: 'default',
        securityLevel: 'loose',
        flowchart: { 
            htmlLabels: true,
            curve: 'basis'
        },
        themeVariables: {
            primaryColor: '#dce5f2',
            primaryTextColor: '#24292f',
            primaryBorderColor: '#8b949e',
            lineColor: '#57606a',
            secondaryColor: '#fff8dc',
            tertiaryColor: '#f6f8fa',
            background: '#ffffff'
        }
    });

    // Find all pre elements in article content
    document.querySelectorAll('.article-content pre').forEach(function(pre) {
        // Get innerHTML to preserve structure
        var rawContent = pre.innerHTML;
        
        // Convert paragraph and line break tags to newlines
        var content = rawContent
            .replace(/<\/p>\s*<p[^>]*>/gi, '\n')  // </p><p> to newline
            .replace(/<p[^>]*>/gi, '')             // Remove opening <p> tags
            .replace(/<\/p>/gi, '\n')              // </p> to newline
            .replace(/<br\s*\/?>/gi, '\n')         // <br> to newline
            .replace(/<[^>]+>/g, '')               // Remove any other HTML tags
            .replace(/&nbsp;/gi, ' ')              // Non-breaking space to space
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&')
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, "'")
            .replace(/\n\s*\n\s*\n/g, '\n\n')     // Collapse multiple blank lines
            .trim();
        
        // Check if this is a Mermaid diagram (starts with mermaid keywords)
        var mermaidKeywords = ['graph ', 'graph\n', 'flowchart ', 'flowchart\n', 
                               'sequenceDiagram', 'classDiagram', 
                               'stateDiagram', 'erDiagram', 'gantt', 'pie ', 
                               'pie\n', 'journey', 'gitGraph', 'mindmap', 
                               'timeline', 'quadrantChart'];
        var isMermaid = mermaidKeywords.some(function(keyword) {
            return content.toLowerCase().startsWith(keyword.toLowerCase());
        });
        
        if (isMermaid) {
            // Create container with controls like GitHub
            var container = document.createElement('div');
            container.className = 'mermaid-container';
            
            // Create Mermaid div
            var mermaidDiv = document.createElement('div');
            mermaidDiv.className = 'mermaid';
            mermaidDiv.textContent = content;
            
            // Create controls
            var controls = document.createElement('div');
            controls.className = 'mermaid-controls';
            controls.innerHTML = `
                <button title="Zoom in" onclick="this.closest('.mermaid-container').querySelector('svg').style.transform = 'scale(' + (parseFloat(this.closest('.mermaid-container').querySelector('svg').style.transform.replace('scale(','').replace(')','') || 1) + 0.2) + ')'">
                    <i class="fas fa-search-plus"></i>
                </button>
                <button title="Zoom out" onclick="this.closest('.mermaid-container').querySelector('svg').style.transform = 'scale(' + Math.max(0.2, (parseFloat(this.closest('.mermaid-container').querySelector('svg').style.transform.replace('scale(','').replace(')','') || 1) - 0.2)) + ')'">
                    <i class="fas fa-search-minus"></i>
                </button>
                <div class="divider"></div>
                <button title="Reset zoom" onclick="this.closest('.mermaid-container').querySelector('svg').style.transform = 'scale(1)'">
                    <i class="fas fa-sync-alt"></i>
                </button>
            `;
            
            container.appendChild(controls);
            container.appendChild(mermaidDiv);
            pre.replaceWith(container);
            return;
        }
        
        // Skip if already has a code child with language class
        if (pre.querySelector('code[class*="language-"]')) return;
        
        // Create code element with Python as default language
        var code = document.createElement('code');
        code.className = 'language-python';
        code.textContent = pre.textContent;
        
        // Clear pre and add code element
        pre.innerHTML = '';
        pre.appendChild(code);
        
        // Run Prism highlighting
        Prism.highlightElement(code);
    });
    
    // Render all Mermaid diagrams with error handling
    document.querySelectorAll('.mermaid').forEach(async function(el, index) {
        try {
            var id = 'mermaid-' + index;
            var result = await mermaid.render(id, el.textContent);
            el.innerHTML = result.svg;
        } catch (error) {
            console.error('Mermaid error:', error);
            console.error('Diagram content:', el.textContent);
            el.innerHTML = '<pre style="color: red;">Mermaid Error: ' + (error.message || JSON.stringify(error)) + '</pre>';
        }
    });
});
</script>
{% block extra_js %}{% endblock %}
</body>
</html>
